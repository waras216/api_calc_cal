[phases.setup]
nixPkgs = [
    "python3",
    "mariadb" 
]

[phases.install]
# ESTA ES LA CLAVE: Combinar la creación, la activación y la instalación
# en una sola cadena de comandos para evitar que Docker rompa la sesión de shell.
cmds = [
    "python -m venv .venv && . .venv/bin/activate && pip install -r requirements.txt"
]

[start]
# El comando de inicio también debe activar el venv.
cmd = ". .venv/bin/activate && gunicorn backend_calories_calc.wsgi:application --bind 0.0.0.0:$PORT"